parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"EHrm":[function(require,module,exports) {
module.exports={name:"wacoq-bin",version:"0.12.1",description:"WASM Binaries of the Coq Proof Assistant (for jsCoq)",main:"dist/index.html",author:"corwin-of-amber",repository:{type:"git",url:"github:corwin-of-amber/wacoq-bin"},license:"MIT",scripts:{build:"parcel build src/worker.ts && etc/build-node.sh",dist:"make dist-npm",postinstall:"node ./etc/postinstall.js"},bin:{wacoq:"./index.js"},dependencies:{"@ocaml-wasm/4.10--num":"^1.4.0-0","array-equal":"^1.0.0",byline:"^5.0.0",commander:"^5.1.0",fflate:"^0.3.6","fflate-unzip":"^0.3.6-0",find:"^0.3.0","find-up":"^5.0.0",jquery:"^3.5.1",jszip:"^3.5.0","jszip-unzip":"^3.4.0-0",mkdirp:"^1.0.4",neatjson:"^0.8.3","ocaml-wasm":"^4.10.2-0","wasi-kernel":"^0.1.2"},devDependencies:{"@types/find":"^0.2.1","@types/jquery":"^3.5.0","@types/mkdirp":"^1.0.1","@types/node":"^14.0.27",cssnano:"^4.1.10",typescript:"^4.1.3"},bundledDependencies:["jszip","neatjson"],browserslist:["Chrome 78"]};
},{}],"sSM6":[function(require,module,exports) {
"use strict";var e=a(require("jquery"));function a(e){return e&&e.__esModule?e:{default:e}}class t{richpp2HTML(e){if(e.constructor!==Array)return e;var a,t,r,l,d,n;switch([t,r]=e,t){case"Element":[l,d,n]=r;let s=n.map(this.richpp2HTML,this);a=`<span class="${l}">`+(a="".concat(...s))+"</span>";break;case"PCData":a=r;break;default:a=e}return a}pp2DOM(a){if(a.constructor!==Array)throw new Error("malformed Pp element: "+a);var[t,r]=a;switch(t){case"Pp_glue":return r.length>0?r.map(e=>this.pp2DOM(e)).reduce((e,a)=>e.add(a)):(0,e.default)([]);case"Pp_string":return(0,e.default)(document.createTextNode(r));case"Pp_box":let l="Pp_vbox"==r[0]?"vertical":"horizontal";return this.adjustBox((0,e.default)("<div>").addClass("Pp_box").attr("data-mode",l).append(this.pp2DOM(a[2])));case"Pp_tag":return this._wrapTrimmed(this.pp2DOM(a[2]),(0,e.default)("<span>").addClass(r));case"Pp_force_newline":return(0,e.default)("<br/>").addClass("Pp_force_newline");case"Pp_print_break":return(0,e.default)("<span>").addClass("Pp_break").attr("data-break",a.slice(1)).text(" ");case"Pp_empty":return(0,e.default)([]);default:return console.warn("unhandled Format case",a),(0,e.default)([])}}pp2HTML(e,a){if(e.constructor!==Array)return e;var t,r,l;switch(a=a||{breakMode:"horizontal"},[r,l]=e,r){case"Pp_glue":let s=l.map(e=>this.pp2HTML(e,a));t="".concat(...s);break;case"Pp_string":l.match(/^={4}=*$/)?(t="<hr/>",a.breakMode="skip-vertical"):"vertical"===a.breakMode&&l.match(/^\ +$/)?(t="",a.margin=l):t=l;break;case"Pp_box":var d=a.breakMode,n=a.margin?a.margin.length:0;switch(a.margin=null,e[1][0]){case"Pp_vbox":a.breakMode="vertical";break;default:a.breakMode="horizontal"}t=`<div class="Pp_box" data-mode="${a.breakMode}" data-margin="${n}">`+this.pp2HTML(e[2],a)+"</div>",a.breakMode=d;break;case"Pp_tag":t=this.pp2HTML(e[2],a),t=`<span class="${e[1]}">`+t+"</span>";break;case"Pp_force_newline":t="<br/>",a.margin=null;break;case"Pp_print_break":t="",a.margin=null,"vertical"===a.breakMode||0==e[1]&&e[2]>0?t="<br/>":"horizontal"===a.breakMode?t=`<span class="Pp_break" data-break="${e.slice(1)}"> </span>`:"skip-vertical"===a.breakMode&&(a.breakMode="vertical");break;case"Pp_empty":t="";break;default:console.warn("unhandled Format case",e),t=e}return t}pp2Text(e,a){if(!Array.isArray(e))return e;var t,r,l;switch(a=a||{breakMode:"horizontal"},[r,l]=e,r){case"Pp_glue":let n=l.map(e=>this.pp2Text(e,a));t="".concat(...n);break;case"Pp_string":"vertical"===a.breakMode&&l.match(/^\ +$/)?(t="",a.margin=l):t=l;break;case"Pp_box":var d=a.breakMode;a.margin&&a.margin.length;switch(a.margin=null,e[1][0]){case"Pp_vbox":a.breakMode="vertical";break;default:a.breakMode="horizontal"}t=this.pp2Text(e[2],a),a.breakMode=d;break;case"Pp_tag":t=this.pp2Text(e[2],a);break;case"Pp_force_newline":t="\n",a.margin=null;break;case"Pp_print_break":t="",a.margin=null,"vertical"===a.breakMode||0==e[1]&&e[2]>0?t="\n":"horizontal"===a.breakMode?t=" ":"skip-vertical"===a.breakMode&&(a.breakMode="vertical");break;case"Pp_empty":t="";break;default:console.warn("unhandled Format case",e),t=e}return t}goals2DOM(a){var t=a.goals.length,r=this.flatLength(a.stack),l=a.shelf.length,d=a.given_up.length;function n(a){var t=(0,e.default)("<p>").addClass("aside");return"string"==typeof a?t.text(a):t.append(a)}if(0===t){let t=r?"This subproof is complete, but there are some unfocused goals.":l?"All the remaining goals are on the shelf.":"No more goals.",s=d?[`(${d} goal${d>1?"s were":" was"} admitted.)`]:[],o=(a.bullet?[this.pp2DOM(a.bullet)]:[]).concat(s);return(0,e.default)("<div>").append((0,e.default)("<p>").addClass("no-goals").text(t),o.map(n))}{let r=1===t?"1 goal":`${t} goals`,d=l?[`(shelved: ${l})`]:[],s=this.goal2DOM(a.goals[0]),o=a.goals.slice(1).map((a,t)=>(0,e.default)("<div>").addClass("coq-subgoal-pending").append((0,e.default)("<label>").text(t+2)).append(this.pp2DOM(a.ty)));return(0,e.default)("<div>").append((0,e.default)("<p>").addClass("num-goals").text(r),d.map(n),s,o)}}goal2DOM(a){let t=a=>(0,e.default)("<label>").text(this.constructor._idToString(a)),r=a=>(0,e.default)("<span>").addClass("def").append(this.pp2DOM(a)),l=a.hyp.reverse().map(([a,l,d])=>(0,e.default)("<div>").addClass(["coq-hypothesis",l&&"coq-has-def"]).append(a.map(t)).append(l&&r(l)).append(this.pp2DOM(d))),d=this.pp2DOM(a.ty);return(0,e.default)("<div>").addClass("coq-env").append(l,(0,e.default)("<hr/>"),d)}static _idToString(e){return console.assert("Id"===e[0]),e[1]}flatLength(e){return Array.isArray(e)?e.map(e=>this.flatLength(e)).reduce((e,a)=>e+a,0):1}adjustBox(a){if("vertical"==a.attr("data-mode"))for(let t of a.children(".Pp_break"))(0,e.default)(t).replaceWith((0,e.default)("<br/>"));return a}adjustBreaks(a){var t=a.width(),r=a.add(a.find('.Pp_box[data-mode="horizontal"]'));for(let d of r){let a=(0,e.default)(d),r=a.children(".Pp_break");var l=null;for(let d of r)l&&(0,e.default)(d).position().left>=t&&l.html("<br/>"),l=(0,e.default)(d);l&&a.position().left+a.width()>t&&l.html("<br/>")}0==a.children().length&&a.addClass("text-only")}_wrapTrimmed(a,t){if(0===a.length)return t;var r,l,d=a[0],n=a[a.length-1];return d.nodeType===Node.TEXT_NODE&&(r=d.nodeValue.match(/^\s*/)[0],d.nodeValue=d.nodeValue.substring(r.length)),n.nodeType===Node.TEXT_NODE&&(l=n.nodeValue.match(/\s*$/),n.nodeValue=n.nodeValue.substring(0,l.index),l=l[0]),(0,e.default)([r&&document.createTextNode(r),t.append(a)[0],l&&document.createTextNode(l)].filter(e=>e))}}"undefined"!=typeof module&&(module.exports={FormatPrettyPrint:t});
},{}],"anFH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fsif_native=void 0;const e={fs:require("fs"),path:require("path")};exports.fsif_native=e;
},{}],"wpVs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CoqDep=void 0;var e=require("./fsif"),t=require("./project");class s{constructor(s=e.fsif_native){this.volume=s,this.searchPath=new t.SearchPath(s),this.deps=[],this.extern=new Set}processPackage(e){this.processModules(this.searchPath.modulesOf(e))}processModules(e){for(let t of e)this.processModule(t)}processModule(e){e.physical.endsWith(".v")&&this.processVernacFile(e.physical,e)}processVernacFile(e,t){(t=t||{volume:this.volume,logical:this.searchPath.toLogical(e),physical:e}).logical&&this.processVernac(t.volume.fs.readFileSync(e,"utf-8"),t)}processVernac(e,t){var s=[...this._extractImports(e)];s.length>0&&this.deps.push({from:t,to:s});for(let r of this._getExtern(s))this.extern.add(r)}depsToJson(){var e={},t=e=>e.logical.join(".");for(let s of this.deps)e[t(s.from)]=s.to.map(t);return e}buildOrder(e){e||(e=this.searchPath.modules());var t=new Map,s=new Map,r=e=>e.logical.join(".");for(let{from:l,to:i}of this.deps){let e=r(l);for(let s of i){let o=r(s);t.set(o,(t.get(o)||[]).concat([e]))}}for(let l of e){var o=r(l);!l.physical.endsWith(".v")&&s.has(o)||s.set(o,l)}return this._topologicalSort([...s.keys()],t).map(e=>s.get(e))}_topologicalSort(e,t){var s=new Map;for(let i of e)s.set(i,e.filter(e=>(t.get(e)||[]).includes(i)).length);for(var r=[],o=e.filter(e=>!s.get(e));o.length>0;){var l=o.shift();r.push(l);for(let e of t.get(l)||[]){let t=s.get(e)-1;s.set(e,t),0==t&&o.push(e)}}return r.length<e.length&&console.warn("coqdep: cyclic dependency detected",e.filter(e=>-1==r.indexOf(e))),r}_extractImports(e){return this._uniqBy(this._extractImportsBase(e),e=>e.logical.join("."))}*_extractImportsBase(e){e=e.replace(/\(\*([^*]|[*][^)])*?\*\)/g," ");for(let a of e.split(/[.](?:\s|$)/)){var t=/^\s*(?:From\s+(.*?)\s+)?Require(\s+(?:Import|Export))*\s+(.*)/.exec(a);if(t){var[s,r,o,l]=t,i=l.split(/\s+/);for(let e of i)for(let t of this._resolve(r,e))yield t}}}_resolve(e,t){return this.searchPath.findModules(e,t)}*_getExtern(e){var t=this.searchPath.packageIndex;if(t)for(let s of e)yield*t.findPackageDeps(null,s.logical,!0)}*_uniqBy(e,t){var s=new Set;for(let o of[...e]){var r=t(o);s.has(r)||(s.add(r),yield o)}}}exports.CoqDep=s;
},{"./fsif":"anFH","./project":"kdub"}],"L1JH":[function(require,module,exports) {
var t=null;function e(){return t||(t=n()),t}function n(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(t)return r(t[0])}return"/"}function r(t){return(""+t).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}exports.getBundleURL=e,exports.getBaseURL=r;
},{}],"mC3k":[function(require,module,exports) {
var r=require("./bundle-url").getBundleURL;function e(r){Array.isArray(r)||(r=[r]);var e=r[r.length-1];try{return Promise.resolve(require(e))}catch(n){if("MODULE_NOT_FOUND"===n.code)return new s(function(n,i){t(r.slice(0,-1)).then(function(){return require(e)}).then(n,i)});throw n}}function t(r){return Promise.all(r.map(u))}var n={};function i(r,e){n[r]=e}module.exports=exports=e,exports.load=t,exports.register=i;var o={};function u(e){var t;if(Array.isArray(e)&&(t=e[1],e=e[0]),o[e])return o[e];var i=(e.substring(e.lastIndexOf(".")+1,e.length)||e).toLowerCase(),u=n[i];return u?o[e]=u(r()+e).then(function(r){return r&&module.bundle.register(t,r),r}).catch(function(r){throw delete o[e],r}):void 0}function s(r){this.executor=r,this.promise=null}s.prototype.then=function(r,e){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.then(r,e)},s.prototype.catch=function(r){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.catch(r)};
},{"./bundle-url":"L1JH"}],"kdub":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.JsCoqCompat=exports.ZipVolume=exports.InMemoryVolume=exports.ModuleIndex=exports.SearchPath=exports.CoqProject=void 0;var e=a(require("path")),t=require("./fsif"),s=require("./coqdep"),i=a(require("array-equal")),r=require("fflate"),o=require("neatjson");function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,i)}return s}function n(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?l(Object(s),!0).forEach(function(t){c(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):l(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function c(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const h=t.fsif_native.fs;class p{constructor(e,s=t.fsif_native){this.volume=s,this.name=e,this.deps=[],this.searchPath=new f(s),this.opts={json:{padding:1,afterColon:1,afterComma:1,wrap:80},zip:{}}}fromJson(e,t="",s=this.volume){for(let l in e){var i=this.toDirPath(e[l].prefix||"");for(let n of e[l].dirpaths||[""]){var r=this.toDirPath(n),o=s.path.join(t,l,...r),a={volume:s,physical:o,logical:i.concat(r),pkg:this.name};"string"==typeof n||n.rec?this.searchPath.addRecursive(a):this.searchPath.add(a)}}return this}fromDirectory(e="",t=this.volume){try{var s=t.fs.readFileSync(t.path.join(e,"_CoqProject"),"utf-8")}catch(i){}return s?this.fromCoqMF(s,e,t):(this.searchPath.addRecursive({volume:t,physical:e,logical:"",pkg:this.name}),this)}fromCoqMF(e,t="",s=this.volume){var i=this.name,r=[];for(let c of e.split(/\n+/)){var o=/^\s*(-[RQ])\s+(\S+)\s+(\S+)/.exec(c);if(o){var[a,l,n]=[o[1],o[2],o[3]];l=s.path.join(t,l),"-R"===a?this.searchPath.addRecursive({volume:s,physical:l,logical:n,pkg:i}):this.searchPath.add({volume:s,physical:l,logical:n,pkg:i})}else for(let e of c.matchAll(/\S+[.]v/g))r.push(e[0])}return r.length>0&&this.setModules(r),this}setModules(e){this._modules=e.map(e=>"string"==typeof e?{volume:this.volume,physical:e,logical:this.searchPath.toLogical(e),pkg:this.name}:e)}computeDeps(){var e=new s.CoqDep;return e.searchPath=this.searchPath,e.processModules(this.modules()),e}modules(){return this._modules||this.searchPath.modulesOf(this.name)}modulesByExt(e){return this.modulesByExts([e])}*modulesByExts(e){for(let t of this.modules())e.some(e=>t.physical.endsWith(e))&&(yield t)}listModules(){return this.searchPath._listNames(this.modules())}createManifest(){var e=this.computeDeps().depsToJson(),t={};for(let s of this.listModules())t[s]=e[s]?{deps:e[s]}:{};return{name:this.name,deps:this.deps,modules:t}}toDirPath(e){return this.searchPath.toDirPath("string"==typeof e?e:e.logical)}copyLogical(e=new v){for(let{volume:t,physical:s,logical:i}of this.modulesByExt(".v"))e.fs.writeFileSync(`/${i.join("/")}.v`,t.fs.readFileSync(s));return new p(this.name,e).fromDirectory("/")}async toZip(e,t=[".vo",".cma"],s=(e=>[e])){var i=new u(this.opts.zip);e&&i.writeFileSync("coq-pkg.json",e);for(let a of this.modulesByExts(t))for(let e of s(a)){var r=e.ext||e.physical.match(/[.][^.]+$/)[0];try{i.writeFileSync(e.logical.join("/")+r,e.payload||e.volume.fs.readFileSync(e.physical))}catch(o){console.warn(`skipped ${e.physical} (${o})`)}}return i}async toPackage(e=this.name,t,s=(e=>[e]),i=(e=>e)){e.match(/[.][^./]+$/)||(e+=".coq-pkg");var r=i(this.createManifest(),e),a=e.replace(/[.][^./]+$/,".json"),l=(0,o.neatJSON)(r,this.opts.json);return new d({filename:e,zip:await this.toZip(l,t,s)},{filename:a,json:l,object:r})}}exports.CoqProject=p;class u{constructor(e){this.z={},this.opts=e}writeFileSync(e,t){"string"==typeof t&&(t=(new TextEncoder).encode(t)),this.z[e]=t}zipSync(){return(0,r.zipSync)(this.z)}}class d{constructor(e,t){this.pkg=e,this.manifest=t}async save(t){const s=require("mkdirp").sync;return s(e.default.dirname(this.pkg.filename)),t?(t.chunks||(t.chunks=[]),t.chunks.push(this.manifest.object)):(s(e.default.dirname(this.manifest.filename)),h.writeFileSync(this.manifest.filename,this.manifest.json)),h.writeFileSync(this.pkg.filename,this.pkg.zip.zipSync()),this}}class f{constructor(e=t.fsif_native){this.volume=e,this.path=[]}add({volume:e,physical:t,logical:s,pkg:i}){e=e||this.volume,s=this.toDirPath(s),this.has({volume:e,physical:t,logical:s,pkg:i})||this.path.push({volume:e,logical:s,physical:t,pkg:i})}addRecursive({volume:e,physical:t,logical:s,pkg:i}){e=e||this.volume,s=this.toDirPath(s),this.add({volume:e,physical:t,logical:s,pkg:i});for(let o of e.fs.readdirSync(t)){var r=e.path.join(t,o);e.fs.statSync(r).isDirectory()&&this.addRecursive({volume:e,physical:r,logical:s.concat([o]),pkg:i})}}addFrom(e){e instanceof p&&(e=e.searchPath),this.path.push(...e.path)}has({volume:e,physical:t,logical:s,pkg:r}){return void 0!==s&&(s=this.toDirPath(s)),this.path.find(o=>{(void 0===e||o.volume===e)&&(void 0===t||o.physical===t)&&(void 0===s||(0,i.default)(o.logical,s))&&(void 0===r||o.pkg)})}toLogical(e){var t=this.volume.path.dirname(e),s=this.volume.path.basename(e).replace(/[.]vo?$/,"");for(let{logical:i,physical:r}of this.path)if(r===t)return i.concat([s])}toDirPath(e){return"string"==typeof e?e.split(".").filter(e=>e):e}*modules(){for(let{volume:e,logical:t,physical:s,pkg:i}of this.path)for(let r of e.fs.readdirSync(s))if(r.match(/[.](vo?|cma)$/)){let o=r.replace(/[.](vo?|cma)$/,""),a=e.path.join(s,r);yield{volume:e,logical:t.concat([o]),physical:a,pkg:i}}}*modulesOf(e){for(let t of this.modules())t.pkg===e&&(yield t)}listModules(){return this._listNames(this.modules())}listModulesOf(e){return this._listNames(this.modulesOf(e))}_listNames(e){let t=new Set,s=e=>e.logical.join(".");for(let i of e)t.add(s(i));return t}*findModules(e,t,s=!1){yield*this.moduleIndex?this.moduleIndex.findModules(e,t,s):this._findModules(e,t,s),yield*this._findExtern(e,t,s)}*_findModules(e,t,s=!1){var r=this.toDirPath(e)||[],o=this.toDirPath(t);let a=s?e=>(0,i.default)(e,r.concat(o)):e=>((e,t)=>(0,i.default)(e.slice(0,t.length),t))(e,r)&&((e,t)=>0==t.length||(0,i.default)(e.slice(-t.length),t))(e,o);for(let i of this.modules())a(i.logical)&&(yield i)}*_findExtern(e,t,s=!1){if(this.packageIndex)for(let i of this.packageIndex.findModules(e,t,s))yield{volume:null,physical:null,logical:i.split("."),pkg:"+"}}createIndex(){this.moduleIndex=new m;for(let e of this.modules())this.moduleIndex.add(e);return this.moduleIndex}}exports.SearchPath=f;class m{constructor(){this.index=new Map}add(e){this.index.set((e=>e.logical.join("."))(e),e)}*findModules(e,t,s=!1){if(Array.isArray(e)&&(e=e.join(".")),Array.isArray(t)&&(t=t.join(".")),e=e?e+".":"",s){var i=this.index.get(e+t);i&&(yield i)}else{var r="."+t;for(let[s,i]of this.index.entries())s.startsWith(e)&&(s==t||s.endsWith(r))&&(yield i)}}}exports.ModuleIndex=m;class y{constructor(){this.fs=this,this.path=t.fsif_native.path}readdirSync(e){let t=[];""===e||e.endsWith("/")||(e+="/");for(let i of this._files)if(i.startsWith(e)){var s=i.substring(e.length).split("/").filter(e=>e);s[0]&&!t.includes(s[0])&&t.push(s[0])}return t}statSync(e){var t=e.replace(/(^|([^/]))$/,"$2/");for(let s of this._files)if(s.startsWith(t))return{isDirectory:()=>!0};throw new Error(`ENOENT: '${e}'`)}}class v extends y{constructor(){super(),this.fileMap=new Map}get _files(){return this.fileMap.keys()}writeFileSync(e,t){"string"==typeof t&&(t=(new TextEncoder).encode(t)),this.fileMap.set(e,t)}readFileSync(e,t){var s=this.fileMap.get(e);if(s)return t?(new TextDecoder).decode(s):s;throw new Error(`ENOENT: '${e}'`)}statSync(e){return this.fileMap.get(e)?{isDirectory:()=>!1}:super.statSync(e)}renameSync(e,t){e!==t&&(this.fileMap.set(t,this.readFileSync(e)),this.fileMap.delete(e))}unlinkSync(e){this.fileMap.delete(e)}}exports.InMemoryVolume=v;class g extends y{constructor(e){super(),this.zip=e,this._files=[],this.zip.forEach(e=>this._files.push(e))}readFileSync(e,t){var s=this.zip.files[e];if(s)return this._inflateSync(s);throw new Error(`ENOENT: ${e}`)}statSync(e){var t=this.zip.files[e]||this.zip.files[e+"/"];return t?{isDirectory:()=>t&&t.dir}:super.statSync(e)}static async fromFile(e){const t=w(await require("_bundle_loader")(require.resolve("jszip")));return new g(await t.loadAsync((0,h.readFileSync)(e)))}static async fromBlob(e){const t=w(await require("_bundle_loader")(require.resolve("jszip")));return new g(await t.loadAsync(e))}_inflateSync(e){const{DEFLATE:t}=require("jszip/lib/compressions"),{inflateRaw:s}=require("pako");return e._data.compression==t?s(e._data.compressedContent):e._data.compressedContent}}function w(e){return e.default||e}exports.ZipVolume=g;class x{static transpilePluginsJs(e){if(e.physical.endsWith(".cma")){const t=require("child_process"),s=e.physical,i=`${s}.js`;return t.execSync(`js_of_ocaml --wrap-with-fun= -o ${i} ${s}`),[n(n({},e),{},{payload:new Uint8Array}),n(n({},e),{},{physical:i,ext:".cma.js"})]}return[e]}static backportManifest(t,s){var i={};for(let e in t.modules){var[r,o]=e.split(/[.]([^.]+)$/);(i[r]=i[r]||[]).push(o)}var a=Object.entries(i).map(([e,t])=>({pkg_id:e.split("."),vo_files:t.map(e=>[`${e}.vo`,null]),cma_files:[]})),l={};for(let e in t.modules){var n=t.modules[e].deps;n&&(l[e]=n)}var c=t.archive||s&&e.default.basename(s);return{desc:t.name,deps:t.deps||[],archive:c,pkgs:a,modDeps:l}}}exports.JsCoqCompat=x;
},{"./fsif":"anFH","./coqdep":"wpVs","_bundle_loader":"mC3k"}],"OJcE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Workspace=void 0;var e=o(require("fs")),r=o(require("path")),t=require("neatjson"),a=require("./project");function o(e){return e&&e.__esModule?e:{default:e}}class s{constructor(){this.projs={},this.searchPath=new a.SearchPath,this.pkgDir="bin/coq",this.outDir=""}open(r,t){try{var a=JSON.parse(e.default.readFileSync(r));a.builddir&&(this.outDir=a.builddir),a.bundle&&(this.bundleName=a.bundle),this.openProjects(a.projects,t||a.rootdir)}catch(o){console.warn(`cannot open workspace '${r}': ${o}`)}}async loadDeps(e,t=""){for(let s of e){(s=s.replace(/^[+]/,this.pkgDir.replace(/([^/])$/,"$1/"))).match(/[.][^./]+$/)||(s+=".coq-pkg");var o=new a.CoqProject(s).fromDirectory("",await a.ZipVolume.fromFile(r.default.join(t,s)));this.searchPath.addFrom(o)}}addProject(e){this.projs[e.name]=e,this.searchPath.addFrom(e),e.searchPath=this.searchPath}openProjects(e,r){for(let o in e){var t=new a.CoqProject(o).fromJson(e[o],r);this.addProject(t)}}openProjectDirect(e,t,o,s){var i=r.default.basename(e).replace(/[.][^.]*$/,"");let n=new a.CoqProject(i).fromJson({"":{prefix:o,dirpaths:s}},t);this.addProject(n)}createBundle(a){var o=r.default.basename(a).replace(/[.]json$/,"");return a.match(/[.]json$/)||(a+=".json"),{manifest:{name:o,deps:[],pkgs:[],chunks:[]},filename:a,save(){e.default.writeFileSync(this.filename,(0,t.neatJSON)(this.manifest))}}}}exports.Workspace=s;
},{"./project":"kdub"}],"ugbW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BuildError=exports.CompileTask=exports.BatchWorker=exports.Batch=void 0;var t=require("events"),s=require("./project");class e{constructor(){this.volume=null}async do(...t){var s=[];for(let e of t)"function"==typeof e?s.push(await this.expect(e)):this.command(e);return s}isError(t){return["JsonExn","CoqExn"].includes(t[0])}}exports.Batch=e;class o extends e{constructor(t){super(),this.worker=t}command(t){this.worker.postMessage(t)}expect(t,s=(t=>this.isError(t))){const e=this.worker;return new Promise((o,i)=>{function r(e){t(e.data)?(a(),o(e.data)):s(e.data)&&(a(),i(e.data))}function a(){e.removeEventListener("message",r)}e.addEventListener("message",r)})}}exports.BatchWorker=o;class i extends t.EventEmitter{constructor(t,e,o={}){super(),this.infiles=[],this.outfiles=[],this._stop=!1,this.batch=t,this.inproj=e,this.opts=o,this.volume=t.volume||new s.InMemoryVolume}async run(t){if(!this._stop){var s=this.inproj.computeDeps(),e=s.buildOrder();await this.loadPackages(s.extern);for(let t of e){if(this._stop)break;t.physical.endsWith(".v")&&await this.compile(t)}return this.output(t)}}async loadPackages(t){t.size>0&&await this.batch.do(["LoadPkg",[...t].map(t=>`+${t}`)],t=>"LoadedPkg"==t[0])}async compile(t,s=this.opts){var{volume:e,logical:o,physical:i}=t,r=`/lib/${o.join("/")}.v`,a=`${r}o`;this.infiles.push(t),this.emit("progress",[{filename:i,status:"compiling"}]);try{if(await this.batch.do(["Init",{top_name:o.join(".")}],["Put",r,e.fs.readFileSync(i)],["Load",r],t=>"Loaded"==t[0],["Compile",a],t=>"Compiled"==t[0]),!this.batch.volume){let[[,,t]]=await this.batch.do(["Get",a],t=>"Got"==t[0]);this.volume.fs.writeFileSync(a,t)}this.outfiles.push({volume:this.volume,logical:o,physical:a}),this.emit("progress",[{filename:i,status:"compiled"}])}catch(h){throw this.emit("report",h),this.emit("progress",[{filename:i,status:"error"}]),h}}stop(){this._stop=!0}output(t){this.outproj=new s.CoqProject(t||this.inproj.name||"out",this.volume);for(let s of this.outfiles)s.pkg=this.outproj.name;return this.outproj.searchPath.addRecursive({physical:"/lib",logical:[]}),this.outproj.setModules(this._files()),this.outproj}toPackage(t,e){return this.outproj.toPackage(t,e,this.opts.jscoq?s.JsCoqCompat.transpilePluginsJs:void 0,this.opts.jscoq?s.JsCoqCompat.backportManifest:void 0)}_files(){return[].concat(this.infiles,this.outfiles)}}exports.CompileTask=i;class r{}exports.BuildError=r;
},{"./project":"kdub"}],"N63k":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.OCamlExecutable=void 0;var a=require("wasi-kernel");class t extends a.ExecCore{constructor(a){super(a)}async run(a,t,e=[]){var s=this.opts.binDir||"../bin";for(let r of this.preloads())await this.proc.dyld.preload(r.name,r.uri);await this.start(`${s}/ocaml/ocamlrun.wasm`,["ocamlrun",a,...t]),this.api=this.wasm.instance.exports,this.callbacks=this._getCallbacks(e)}preloads(){var a=this.opts.binDir||"../bin";return["dllcamlstr","dllunix","dllthreads"].map(t=>({name:`${t}.so`,uri:`${a}/ocaml/${t}.wasm`})).concat({name:"dllnums.so",uri:`${a}/num/dllnums.wasm`})}to_caml_string(a){var t=(new TextEncoder).encode(a),e=this.api.caml_alloc_string(t.length);return this.proc.membuf.set(t,e),e}_getCallbacks(a){var t={},e=this.api.malloc(Math.max(...a.map(a=>a.length))+1);for(let s of a){this.proc.membuf.write(s+"\0",e);let a=this.api.caml_named_value(e);a&&(t[s]=(t=>this.api.caml_callback(this.proc.mem.getUint32(a,!0),t)))}return this.api.free(e),t}}exports.OCamlExecutable=t;
},{}],"wjrj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.IcoqPod=void 0;var e=require("events"),t=require("fflate"),i=require("./ocaml_exec");class s extends e.EventEmitter{constructor(e){super(),e=e||("undefined"==typeof fetch||process.env.NODE_NOW?"./bin":"../bin"),this.binDir=e,this.core=new i.OCamlExecutable({stdin:!1,tty:!1,binDir:e}),this.core.debug=(()=>{}),this.core.trace=(()=>{});var t=new TextDecoder;this.core.on("stream:out",e=>console.log(t.decode(e.data))),this.io=new r}get fs(){return this.core.fs}async boot(){await this.upload(`${this.binDir}/icoq.bc`,"/lib/icoq.bc"),this._preloadStub(),await this.core.run("/lib/icoq.bc",[],["wacoq_post"]),await this.loadPackage("+init",!1)}async upload(e,t){var i=await this.io._fetch(e);this.putFile(t,i)}loadPackage(e,t=!0){return this.loadPackages([e],t)}async loadPackages(e,t=!0){"string"==typeof e&&(e=[e]),await Promise.all(e.map(async e=>{await this.unzip(e,"/lib"),this._progress(e,void 0,!0)})),t&&this.command(["RefreshLoadPath"]),this.answer([["LoadedPkg",e]])}async loadSources(e,t){var i=t.replace(/[.]|([^/])$/g,"$1/");this.unzip(e,`/src/${i}`)}unzip(e,t){return this.io.unzip(this._pkgUri(e),(e,i)=>this.putFile(`${t}/${e}`,i),t=>this._progress(e,t))}_pkgUri(e){return"+"==e[0]?`${this.binDir}/coq/${e.substring(1)}.coq-pkg`:e}_progress(e,t,i=!1){this.emit("progress",{uri:e,download:t,done:i})}putFile(e,t){e.startsWith("/")||(e=`/lib/${e}`),this.fs.mkdirpSync(e.replace(/[/][^/]+$/,"")),this.fs.writeFileSync(e,t)}getFile(e){e.startsWith("/")||(e=`/lib/${e}`);var t=null;try{t=this.fs.readFileSync(e)}catch(i){}this.answer([["Got",e,t]])}command(e){switch(e[0]){case"LoadPkg":return void this.loadPackages(e[1]);case"Put":return void this.putFile(e[1],e[2]);case"Get":return void this.getFile(e[1])}const t=this.core.callbacks&&this.core.callbacks.wacoq_post;if(t){var i="string"==typeof e?e:JSON.stringify(e),s=t(this.core.to_caml_string(i));this._answer(s)}}answer(e){for(let t of e)this.emit("message",t)}_answer(e){var t=this.core.proc.userGetCString(e);this.answer(JSON.parse(t))}_preloadStub(){this.core.proc.dyld.preload("dllbyterun_stubs.so",`${this.binDir}/coq/dllbyterun_stubs.wasm`,{js:{wacoq_emit_js:e=>this._answer(e)}})}}exports.IcoqPod=s;class r{async unzip(e,i,s){var r=(0,t.unzipSync)(await this._fetch(e,s));for(let[t,a]of Object.entries(r))i(t,a)}async _fetch(e,t){return t&&"undefined"!=typeof fetch?this._toU8A(this._fetchWithProgress(e,t)):this._fetchSimple(e)}async _toU8A(e){return new Uint8Array(await(await e).arrayBuffer())}async _fetchSimple(e){if("undefined"!=typeof fetch)return new Uint8Array(await(await fetch(e)).arrayBuffer());return(0,require("fs").readFileSync)(e)}async _fetchWithProgress(e,t){for(var i=await fetch(e),s=+i.headers.get("Content-Length")||1e3,r=i.body.getReader(),a=[],o=0;;){var{value:n,done:c}=await r.read();if(c)break;a.push(n),t({total:s,downloaded:o+=n.length})}return new Blob(a)}}
},{"./ocaml_exec":"N63k"}],"WpMW":[function(require,module,exports) {
module.exports={rootdir:"vendor/coq",builddir:"coq-pkgs",bundle:"coq.json",projects:{init:{theories:{prefix:"Coq",dirpaths:["Init","Bool","Unicode","btauto","ssr","ssrmatching"]},plugins:{prefix:"Coq",dirpaths:["ltac","syntax","btauto","cc","firstorder","ssr","ssrmatching"]}},"coq-base":{theories:{prefix:"Coq",dirpaths:["Logic","Program","Classes","Structures","Relations","Setoids","Wellfounded","Strings","Numbers","extraction","funind"]},plugins:{prefix:"Coq",dirpaths:["extraction","funind"]}},"coq-collections":{theories:{prefix:"Coq",dirpaths:["Lists","Vectors","Sets","FSets","MSets","Sorting"]}},"coq-arith":{theories:{prefix:"Coq",dirpaths:["Arith","NArith","PArith","ZArith","QArith","setoid_ring","omega"]},plugins:{prefix:"Coq",dirpaths:["setoid_ring","omega"]}},"coq-reals":{theories:{prefix:"Coq",dirpaths:["Reals","Floats","micromega","nsatz"]},plugins:{prefix:"Coq",dirpaths:["micromega","nsatz"]}}}};
},{}],"XE8U":[function(require,module,exports) {
"use strict";var e=c(require("path")),o=c(require("commander")),r=require("../package.json"),t=require("./ui/format-pprint"),s=require("./build/project"),i=require("./build/workspace"),a=require("./build/batch"),n=require("./backend/core");function c(e){return e&&e.__esModule?e:{default:e}}global.parcelRequire=void 0;class p extends a.Batch{constructor(o){super(),this.icoq=o,this.queue=[],this.volume={fs:o.fs,path:e.default},this.icoq.on("message",e=>this.queue.push(e))}command(e){this.icoq.command(e)}expect(e,o=this.isError){for(;this.queue.length>0;){let r=this.queue.shift();if(e(r))return Promise.resolve(r);if(o(r))return Promise.reject(r)}}}class l extends n.IcoqPod{constructor(){super(),this.pp=new t.FormatPrettyPrint,this.on("message",e=>this.handleIncoming(e))}handleIncoming(e){switch(e[0]){case"Feedback":switch(e[1].contents[0]){case"Message":console.log(this.pp.pp2Text(e[1].contents[3]))}break;case"CoqExn":e[1]&&console.error(`\n${e[1].fname[1]}:${e[1].line_nb}:`),console.error(this.pp.pp2Text(e[3]));break;default:console.log(e)}}}class d{constructor(e){this.errors=!1,this.opts=e,this.progress=process.stdout.isTTY?function(e,o=!0){process.stdout.write("\r"+e+(o?"\n":""))}:function(e,o=!0){o&&console.log(e)}}async prepare(o=this.opts){var r=new i.Workspace;if(o.outdir&&(r.outDir=o.outdir),o.nostdlib||(r.pkgDir=d.stdlibPkgDir(),o.loads.splice(0,0,...d.stdlibLoads())),o.compile||await r.loadDeps(o.loads),o.workspace)r.open(o.workspace,o.rootdir);else{if(!o.rootdir)throw console.error("what to build? specify either rootdir or workspace."),new a.BuildError;r.openProjectDirect(o.package||e.default.basename(o.rootdir),o.rootdir,o.top,o.dirpaths.split(/[, ]/))}this.workspace=r}async compile(o=this.opts){var r=this.workspace.outDir,t=new l;await t.boot(),await t.loadPackages(o.loads);for(let[c,l]of Object.entries(this.workspace.projs)){var s=new a.CompileTask(new p(t),l,o);await s.run(c);var i=await i.toPackage(o.package||e.default.join(r,c)),{pkg:n}=await i.save();this.progress(`wrote ${n.filename}.`,!0)}}async package(o=this.opts){var r=this.workspace.outDir,t=o.jscoq&&s.JsCoqCompat.transpilePluginsJs,i=o.jscoq&&s.JsCoqCompat.backportManifest;this.workspace.searchPath.createIndex();var a=this.bundle(o),n=a?void 0:o.package;for(let s in this.workspace.projs){this.progress(`[${s}] `,!1);var c=await this.workspace.projs[s].toPackage(n||e.default.join(r,s),void 0,t,i);try{await c.save(a&&a.manifest),this.progress(`wrote ${c.pkg.filename}.`,!0)}catch(p){this.progress(`error writing ${c.pkg.filename}:\n    `+p),this.errors=!0}}a&&(a.save(),this.progress(`wrote ${a.filename}.`,!0))}bundle(o=this.opts){return this.workspace.bundleName?this.workspace.createBundle(e.default.join(this.workspace.outDir,this.workspace.bundleName)):o.package&&Object.keys(this.workspace.projs).length>1?this.workspace.createBundle(o.package):void 0}static stdlib(){return require("./build/metadata/coq-pkgs.json")}static stdlibLoads(){return[...Object.keys(this.stdlib().projects)].map(e=>`+${e}`)}static stdlibPkgDir(){return e.default.join(__dirname,"../bin/coq")}}async function u(){var e=[],t=o.default.name("wacoq").version(r.version,"-v, --version").option("--workspace <w.json>","build projects from specified workspace").option("--rootdir <dir>","toplevel directory for finding `.v` and `.vo` files").option("--top <name>","logical name of toplevel directory").option("--dirpaths <a.b.c>","logical paths containing modules (comma separated)","").option("--package <f.coq-pkg>","create a package (default extension is `.coq-pkg`)").option("-d,--outdir <dir>","set default output directory").option("--load <f.coq-pkg>","load package(s) for compilation and for module dependencies (comma separated, may repeat)").option("--compile","compile `.v` files to `.vo`").option("--continue","pick up from previous build").option("--nostdlib","skip loading the standard Coq packages").option("--jscoq","jsCoq compatibility mode").on("option:load",o=>e.push(...o.split(","))).parse(process.argv);if("build"===t.args[0]&&t.args.shift(),t.args.length>0&&(!t.workspace&&t.args[0].endsWith(".json")?t.workspace=t.args.shift():t.rootdir||(t.rootdir=t.args.shift()),t.args.length>0))return console.error("extraneous arguments: ",t.args),1;t.loads=e;var s=new d(t);try{return await s.prepare(),t.compile?await s.compile():await s.package(),s.errors?1:0}catch(i){if(i instanceof a.BuildError)return 1;throw i}}u().then(e=>process.exit(e||0));
},{"../package.json":"EHrm","./ui/format-pprint":"sSM6","./build/project":"kdub","./build/workspace":"OJcE","./build/batch":"ugbW","./backend/core":"wjrj","./build/metadata/coq-pkgs.json":"WpMW"}]},{},["XE8U"], null)