parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"GjP7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SharedQueue=void 0;class t{constructor(t){this._data=t.data,this._wait=t.wait||new Int32Array(new i(8))}static from(i){return new t(i)}to(){return{data:this._data,wait:this._wait}}enqueue(t){let i=Atomics.load(this._wait,0),a=Atomics.load(this._wait,1);return i?i--:i=this._data.length,i!=a?(Atomics.store(this._data,a++,t),Atomics.store(this._wait,1,a),Atomics.notify(this._wait,1,1),1):0}enqueueAll(t){let i=Atomics.load(this._wait,0),a=Atomics.load(this._wait,1);var s;for(i?i--:i=this._data.length,s=0;i!=a&&s<t.length;s++)Atomics.store(this._data,a++,t[s]);return s>0&&(Atomics.store(this._wait,1,a),Atomics.notify(this._wait,1,1)),s}wait(){let t=Atomics.load(this._wait,0),i=Atomics.load(this._wait,1);for(;t==i;)Atomics.wait(this._wait,1,i),i=Atomics.load(this._wait,1)}dequeue(){this.wait();let t=Atomics.load(this._wait,0),i=Atomics.load(this._data,t++);return Atomics.store(this._wait,0,t),Atomics.notify(this._wait,0,1),i}dequeueSome(t,i,a){if(0==t)return 0;this.wait();let s=Atomics.load(this._wait,0),o=Atomics.load(this._wait,1);var e;for(e=0;s!=o&&a<t;e++)i[a++]=Atomics.load(this._data,s++),o>=this._data.length&&(o=0);return Atomics.store(this._wait,0,s),Atomics.notify(this._wait,0,1),e}isEmpty(){return Atomics.load(this._wait,0)==Atomics.load(this._wait,1)}}exports.SharedQueue=t;const i="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;
},{}],"YPBo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TransformStreamDuplex=exports.SimplexStream=void 0;var e=require("events"),t=require("./bits/queue");class r extends e.EventEmitter{constructor(e={}){super(),this.queue=t.SharedQueue.from(e.queue||{data:new Uint8Array(new i(1024))}),this.meta=e.meta||new Int32Array(new i(4)),e.meta||(this.length=-1),this.pos=0,this.blocking=!0}static from(e){return new r(e)}to(){return{queue:this.queue.to(),meta:this.meta}}get length(){return Atomics.load(this.meta,0)}set length(e){Atomics.store(this.meta,0,e)}read(e,t,r,s){if(r>e.length&&(r=e.length),this.queue.isEmpty()){if(t>0)return 0;if(!this.blocking)throw{errno:35,code:"EAGAIN"}}if(this.length>=0&&this.pos>=this.length)return 0;var i=this.queue.dequeueSome(r,e,t);return i>0&&(this.length>=0&&(i=Math.min(this.length-this.pos,i)),this.pos+=i,this.emit("data",e.slice(t,i))),i}write(e){let t=this.queue.enqueueAll(e);return this.pos+=t,t}end(){this.length=this.pos,this.queue.enqueue(0)}reset(){this.length=-1,this.pos=0,this.blocking=!0}}exports.SimplexStream=r;class s extends e.EventEmitter{constructor(e){super(),this.ts=e,this.writer=this.ts.writable.getWriter(),this.reader=this.ts.readable.getReader(),(async()=>{for(;;){let{done:e,value:t}=await this.reader.read();if(t&&this.emit("data",t),e){this.emit("end");break}}})()}write(e){this.writer.write(e)}end(){this.writer.close()}}exports.TransformStreamDuplex=s;const i="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;
},{"./bits/queue":"GjP7"}],"DocZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tty=void 0;var t,e=require("events");class s extends e.EventEmitter{constructor(t){super(),this.core=t,this.fds=[],this.stdin_fl=0,this.termios={flags:[258,3,0,10],win:this.defaultWindow()},this.core.on("stream:out",t=>{this.fds.includes(t.fd)&&this.emit("data",t.data)}),this.debug=(()=>{})}to(){return{termios:{win:this.termios.win}}}makeTty(t){this.core.wasi.FD_MAP.get(t).filetype=2,this.core.wasi.FD_MAP.get(t).rights.base&=~BigInt(36)}write(t){this.core.stdin.write(t)}fd_fdstat_set_flags(t,e){return this.debug(`fdstat_set_flags(${t}, ${e})\n`),0===t&&(this.stdin_fl=e,this.core.stdin.blocking=!(4&e)),0}fd_fdstat_get(t,e){var s=this.core.wasi.wasiImport.fd_fdstat_get(t,e);return 0===t&&this.core.proc.mem.setUint16(e+2,this.stdin_fl,!0),s}defaultWindow(){var t=new Uint16Array(new SharedArrayBuffer(4));return t[0]=24,t[1]=80,t}get overrideImport(){return i(this,["fd_fdstat_get","fd_fdstat_set_flags"])}get import(){return i(this,["tcgetattr","tcsetattr","tgetent"])}get extlib(){return i(this,["tty_ioctl"])}tcgetattr(t,e){this.debug(`tcgetattr(${t}, ${e})`);let s=this.core.proc.mem;return this.termios.flags.forEach((t,i)=>{s.setUint32(e+4*i,t,!0)}),s.setUint8(e+16+1+5,0),s.setUint8(e+16+1+6,1),0}tcsetattr(t,e,s){this.debug(`tcsetattr(${t}, ${e}, ${s})`);let i=this.core.proc.mem,n=r(4).map(t=>i.getUint32(s+4*t,!0)),o=r(32).map(t=>i.getUint8(s+16+1+t));return this.debug(`  [${n.map(t=>"0"+t.toString(8)).join(", ")}] [${o}]`),this.termios.flags=n,this.core.stdin.blocking=o[6]>0,this.core.proc.emit("syscall",{func:"ioctl:tty",data:{fd:t,when:e,flags:n}}),0}tgetent(t,e){return this.debug(`tgetent(_, '${this.core.proc.userGetCString(e)}')`),1}tty_ioctl(e,s,i){if(console.warn("tty_ioctl",e,s,i),1==e){var r=this.core.proc.mem,n=this.termios.win;switch(s){case t.TIOCGWINSZ:for(let t=0;t<n.length;t++)r.setUint16(i+2*t,n[t],!0);break;case t.TIOCSWINSZ:var o=n.map((t,e)=>r.getUint16(i+2*e));this.core.proc.emit("syscall",{func:"ioctl:tty",data:{fd:e,request:s,win:o}})}}}}function i(t,e){return e.reduce((e,s)=>Object.assign(e,{[s]:t[s].bind(t)}),{})}function r(t){return[...Array(t).keys()]}exports.Tty=s,function(t){t[t.TCSETFL=1]="TCSETFL",t[t.TIOCGWINSZ=21523]="TIOCGWINSZ",t[t.TIOCSWINSZ=21524]="TIOCSWINSZ"}(t||(t={}));
},{}],"fQPE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=["signal","raise","pipe","dup","dup2","execv","execl","execvp","execlp","getpwnam","getpwnam_r","getpwent","tcsetpgrp","kill","killpg","fork","getpid","setpgid","getpgrp","setpgrp","issetugid","strsignal","wait4","waitpid","getuid","geteuid","getgid","getegid","umask","getrlimit","setrlimit","sigfillset","sigprocmask","sigsetmask","siginterrupt","sigaltstack","getppid","tcgetpgrp","gethostname","tzset","flockfile","ftrylockfile","funlockfile","getpwuid","getpwuid_r","setpwent","endpwent","getgrgid","setreuid","setregid","strmode","acl_get_file","acl_free","acl_get_entry","fchdir","chown","fchown","lchown","fchownat","chmod","fchmod","fchmodat","lchmod","futimes","utimes","system","mkstemp","mkstemps","mkostemp","mkostemps","tmpfile","settimeofday","bsd_signal","ttyname","dlclose","ctermid_r","socket","connect","popen","pclose","errx","vwarnx","posix_spawn","posix_spawnp","posix_spawnattr_init","posix_spawnattr_destroy","posix_spawnattr_setflags","posix_spawnattr_setsigmask","posix_spawn_file_actions_init","posix_spawn_file_actions_destroy","posix_spawn_file_actions_addopen","posix_spawn_file_actions_addclose","posix_spawn_file_actions_adddup2","pthread_mutex_init","pthread_mutex_lock","pthread_cond_timedwait","pthread_cond_signal","pthread_mutex_unlock","pthread_cond_destroy","pthread_mutex_destroy","pthread_cond_wait","pthread_cond_init","pthread_attr_init","pthread_attr_setstacksize","pthread_attr_destroy","pthread_create","pthread_detach","pthread_self","pthread_exit","pthread_mutex_trylock","pthread_key_create","pthread_key_delete","pthread_setspecific","pthread_getspecific","tgetent","tgetflag","tgetnum","tgetstr","tgoto","tputs","cfgetospeed","cfgetispeed","cfsetospeed","cfsetispeed","tcsendbreak","tcdrain","tcflush","tcflow","tcgetsid"];const e={debug:t=>{}};for(let i of t)e[i]=function(){e.debug(`stub for ${i} [${[...arguments]}]`)};var s=e;exports.default=s;
},{}],"CeSx":[function(require,module,exports) {
"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function t(t){for(var s=1;s<arguments.length;s++){var i=null!=arguments[s]?arguments[s]:{};s%2?e(Object(i),!0).forEach(function(e){r(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.DynamicLibrary=exports.DynamicLoader=void 0;class s{constructor(e){this.core=e}preload(e,t,r){if(this.dylibTable||(this.dylibTable=new i.Table),!this.dylibTable.def.has(e))return this.core.fetchCompile(t).then(t=>{this.dylibTable.def.set(e,new i.Def(t,r))})}get import(){return n(this,["dlopen","dlsym"])}get extlib(){return n(this,["dlerror_get"])}dlopen(e,t){var r=this.userGetCString(e).toString("utf-8");if(this.core.debug(`dlopen("${r}", ${t})`),!this.dylibTable)return 0;var s=this.dylibTable.def.get(r);if(s){var i=s.instantiate(this.core),n=this.dylibTable.ref.size+1;return this.dylibTable.ref.set(n,{instance:i}),n}return 0}dlsym(e,t){var r=this.userGetCString(t).toString("utf-8"),s=this.dylibTable.ref.get(e);if(s){var i=s.instance.exports[r];if(i&&i instanceof Function)return this.allocateFunc(i)}return 0}dlerror_get(e){return this.userCStringMalloc("not found\0",e)}allocateFunc(e){var t=this.core.proc.funcTable.grow(1);return this.core.proc.funcTable.set(t,e),t}userGetCString(e){return this.core.proc.userGetCString(e)}userCStringMalloc(e,t){return this.core.proc.userCStringMalloc(e,t)}}var i;function n(e,t){return t.reduce((t,r)=>Object.assign(t,{[r]:e[r].bind(e)}),{})}exports.DynamicLoader=s,exports.DynamicLibrary=i,function(e){e.Table=class{constructor(){this.def=new Map,this.ref=new Map}};e.Def=class{constructor(e,t={}){this.stackSize=65536,this.memBlocks=10,this.tblSize=1024,this.module=e,this.reloc=t}instantiate(e){var r=e.wasi.memory.buffer.byteLength+this.stackSize,s=e.proc.funcTable.length;e.wasi.memory.grow(this.memBlocks),e.proc.funcTable.grow(this.tblSize);var i=this.globals(this.module,e.wasm.instance),n=new WebAssembly.Instance(this.module,{env:t(t({memory:e.wasi.memory,table:e.proc.funcTable,__indirect_function_table:e.proc.funcTable,__memory_base:r,__table_base:s,__stack_pointer:this._mkglobal(r),stackSave:()=>r,stackRestore:()=>{}},this.relocTable(this.module,e.wasm.instance)),this.emglobals(this.module,r,e.wasm.instance,()=>n)),"GOT.mem":i,wasi_ext:e.proc.extlib});this.globalsInit(n,r,i);var o=n.exports.__post_instantiate;o instanceof Function&&o();var a=n.exports.__wasm_call_ctors;return a instanceof Function&&a(),n}relocTable(e,t){var r=WebAssembly.Module.imports(e),s={};for(let n of r)if("function"===n.kind){var i=t.exports[n.name];i instanceof Function&&(s[n.name]=i)}return Object.assign(s,this.reloc.js||{}),s}globals(e,t){var r=WebAssembly.Module.imports(e),s={};for(let n of r)if("global"===n.kind){var i=t.exports[n.name];s[n.name]=this._mkglobal(i instanceof WebAssembly.Global?i.value:void 0)}return s}globalsInit(e,t,r){for(let i in r){var s=e.exports[i];s instanceof WebAssembly.Global&&(r[i].value=t+s.value)}}emglobals(e,t,r,s){var i=WebAssembly.Module.imports(e),n=WebAssembly.Module.exports(e),o=e=>t+ +s().exports[e],a={};for(let l of i)if("function"===l.kind&&l.name.startsWith("g$")){let e,t=l.name.slice(2);(e=r.exports[t])?a[l.name]=(()=>e):(e=n.find(e=>e.name==t))&&(a[l.name]=(()=>o(t)))}return a}_mkglobal(e=3735928559){return new WebAssembly.Global({value:"i32",mutable:!0},e)}}}(i||(exports.DynamicLibrary=i={}));
},{}],"zmLY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fs=void 0;const _={O_RDONLY:0,O_WRONLY:1,O_RDWR:2,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:512,O_EXCL:2048,O_NOCTTY:131072,O_TRUNC:1024,O_APPEND:8,O_DIRECTORY:1048576,O_NOFOLLOW:256,O_SYNC:128,O_DSYNC:4194304,O_SYMLINK:2097152,O_NONBLOCK:4,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,S_IXOTH:1,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_FS_COPYFILE_EXCL:1,COPYFILE_EXCL:1};class S{constructor(){this.constants=_}strmode(S){const I=_;let O="";return O+={[I.S_IFDIR]:"d",[I.S_IFCHR]:"c",[I.S_IFBLK]:"b",[I.S_IFREG]:"-",[I.S_IFLNK]:"l",[I.S_IFSOCK]:"s",[I.S_IFIFO]:"p"}[S&I.S_IFMT]||"?",O+=S&I.S_IRUSR?"r":"-",O+=S&I.S_IWUSR?"w":"-",O+=S&I.S_IXUSR?"x":"-",O+=S&I.S_IRGRP?"r":"-",O+=S&I.S_IWGRP?"w":"-",O+=S&I.S_IXGRP?"x":"-",O+=S&I.S_IROTH?"r":"-",O+=S&I.S_IWOTH?"w":"-",O+=S&I.S_IXOTH?"x":"-"}}const I=new S;exports.fs=I;
},{}],"SKKL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SignalVector=exports.Proc=void 0;var t=l(require("assert")),e=l(require("path")),r=require("events"),i=l(require("./stubs")),s=require("buffer"),n=require("./queue"),o=require("./dyld"),a=require("./fs"),u=c(require("@wasmer/wasi/lib/constants"));function h(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return h=function(){return t},t}function c(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=h();if(e&&e.has(t))return e.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)){var n=i?Object.getOwnPropertyDescriptor(t,s):null;n&&(n.get||n.set)?Object.defineProperty(r,s,n):r[s]=t[s]}return r.default=t,e&&e.set(t,r),r}function l(t){return t&&t.__esModule?t:{default:t}}function g(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)}return r}function f(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?g(Object(r),!0).forEach(function(e){d(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function d(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class p extends r.EventEmitter{constructor(t,e={}){super(),this.core=t,this.opts=e,this.sigvec=new b,this.sigvec.on("signal",t=>this.emit("syscall",{func:"signal",data:t})),this.childq=new n.SharedQueue({data:new Uint32Array(new S(512))}),this.childset=new Set,this.dyld=new o.DynamicLoader(t),this.pending=[]}init(){const t=this.newfd(),e={real:t,rights:w,filetype:u.WASI_FILETYPE_DIRECTORY,path:".",fakePath:"."};this.core.wasi.FD_MAP.set(m,e),this.core.wasi.FD_MAP.set(t,e),this.core.wasmFs.fs.writeFileSync("/dev/null","")}get import(){return i.default.debug=this.debug,this.sigvec.debug=this.debug,this.funcTable||(this.funcTable=new WebAssembly.Table({initial:this.opts.funcTableSz||1024,element:"anyfunc"})),f(f(f({},i.default),{},{__indirect_function_table:this.funcTable},O(this,["chdir","getcwd","realpath","geteuid","strmode","__control_setjmp","__control_setjmp_with_return","setjmp","longjmp","sigsetjmp","siglongjmp","vfork","__control_fork","wait","wait3","execve","sigkill","sigsuspend","sigaction","getpagesize","posix_spawn"])),this.dyld.import)}get extlib(){return f(f({},O(this,["trace","sorry","dupfd","progname_get","login_get"])),this.dyld.extlib)}get path(){return f(f({},e.default),{},{resolve:(t,...r)=>("."==t&&(t=this.core.env.PWD),e.default.resolve(t||"/",...r))})}get mem(){return this.core.wasi.refreshMemory(),this.core.wasi.view}get membuf(){return s.Buffer.from(this.core.wasi.memory.buffer)}sorry(){for(var t;t=this.pending.pop();t());}chdir(t){var e=this.userGetCString(t).toString("utf-8");this.core.env.PWD=e}getcwd(t,e){if(this.debug("getcwd",t,e),0===t)throw"getcwd(0): not implemented";let r=(this.core.env.PWD||"")+"\0";if(r.length>e)throw{errno:1,code:"ERANGE"};return this.membuf.write(r,t),t}progname_get(t){var e=this.core.argv[0]+"\0";return this.userCStringMalloc(e,t)}login_get(t){return this.userCStringMalloc("user\0",t)}geteuid(){return 0}trace(t){var e=this.userGetCString(t);this.core.trace(e)}realpath(t,r){var i=this.userGetCString(t);if(0===r)throw"realpath(0): not implemented";let s=e.default.resolve(this.core.env.PWD,i.toString("utf-8"))+"\0";if(s.length>v)throw{errno:1,code:"ERANGE"};return this.membuf.write(s,r),r}newfd(t=0){var e=Math.max(...this.core.wasi.FD_MAP.keys());return Math.max(t,e+1)}dupfd(t,e,r){this.debug("dupfd",t,e,r);var i=this.core.wasi.FD_MAP.get(t);if(!i)return-1;var s=this.newfd(e);return this.core.wasi.FD_MAP.set(s,this.dupdesc(i)),s}dupdesc(t){var e=this.core.wasmFs.volume.openSync("/","r"),r=this.core.wasmFs.volume.fds;return r[e]=r[t.real],Object.assign({},t,{real:e})}strmode(t,e){let r=a.fs.strmode(t)+"\0";this.membuf.write(r,e)}__control_setjmp(t,e){this.debug(`__control_setjmp [${t}, ${e}]`),this.mem.setUint32(t,0);let r=this.blockImpl(e),i=0;try{for(;;)try{return r(i)}catch(s){if(this.debug(`setjmp caught ${JSON.stringify(s)}`),!(s instanceof j&&s.env==t))throw s;i=s.val}}finally{this.debug("__control_setjmp exiting")}}__control_setjmp_with_return(t,e){return this.__control_setjmp(t,e)}setjmp(t){return console.warn("setjmp",t),0}longjmp(t,e){throw this.debug(`longjmp [${t}] ${e}`),new j(t,e)}sigsetjmp(t,e){return console.warn("sigsetjmp",t,e),0}siglongjmp(t,e){this.longjmp(t,e)}vfork(){var t=Math.max(0,...this.childset)+1;return this.childset.add(t),this.onJoin=(e=>{if(!(e instanceof y))throw e;{let r=e;this.debug("execv: ",r.prog,r.argv.map(t=>t.toString("utf-8"))),this.emit("syscall",{func:"spawn",data:{pid:t,execv:r,env:this.core.env}})}}),t}__control_fork(t,e,r){let i=this.blockImpl(r);try{i(t),this.onJoin&&this.onJoin(null)}catch(s){this.onJoin&&this.onJoin(s)}this.onJoin=null,i(e)}execve(t,e,r){throw this.debug(`execv(${t}, ${e}, ${r})`),new y(this.userGetCString(t).toString("utf-8"),this.userGetCStrings(e),this.userGetCStrings(r))}posix_spawn(t,e,r,i,s,n){var o=this.userGetCString(e).toString("utf-8");this.debug(`posix_spawn(${t}, "${o}", ${r}, ${i}, ...})`);var a=new y(o,this.userGetCStrings(s),this.userGetCStrings(n)),u=Math.max(0,...this.childset)+1;return this.emit("syscall",{func:"spawn",data:{pid:u,execv:a,env:this.core.env}}),this.mem.setUint32(t,u,!0),0}wait(t){return this.debug(`wait(${t})`),this.waitBase(t)}wait3(t,e,r){return this.debug(`wait3(${t}, ${e}, ${r})`),this.waitBase(t)}waitBase(t){var e=this.childq.dequeue(),r=this.childq.dequeue();return this.debug(`  -> ${e}`),0!==t&&this.mem.setUint32(t,r<<8,!0),e}userGetCString(t){if(0==t)return null;let e=s.Buffer.from(this.core.wasi.memory.buffer);return e.slice(t,e.indexOf(0,t))}userGetCStrings(t){if(0==t)return null;let e=[];for(;;){let r=this.mem.getUint32(t,!0);if(0===r)break;e.push(this.userGetCString(r)),t+=4}return e}userCStringMalloc(t,e){return this.pending.push(()=>{let r=this.mem.getUint32(e,!0);this.membuf.write(t,r)}),t.length}blockImpl(t){let e=this.funcTable.get(this.mem.getUint32(t+12,!0));return(...r)=>e(t,...r)}sigkill(t){this.sigvec.send(t)}sigsuspend(){this.sigvec.receive()}sigaction(t,e,r){this.debug("sigaction",t,e,r);var i=this.mem.getUint32(e,!0),s=this.funcTable.get(i);this.debug(" --\x3e",i,s),this.sigvec.handlers[t]=s,0!=r&&this.mem.setUint32(r,0)}getpagesize(){return 4096}}exports.Proc=p;const m=-100,w={base:u.RIGHTS_ALL,inheriting:u.RIGHTS_ALL};class b extends r.EventEmitter{constructor(t={}){super(),this.wait=t.wait||new Int32Array(new S(4*_)),this.handlers=Array(_)}static from(t){return new b(t)}to(){return{wait:this.wait}}send(e){(0,t.default)(0<e&&e<_),Atomics.add(this.wait,0,1),Atomics.add(this.wait,e,1),Atomics.notify(this.wait,0,1)}receive(t){return this._snapshot||(this._snapshot=new Int32Array(_)),Atomics.wait(this.wait,0,Atomics.load(this.wait,0)),this.sweep(t),-1}sweep(t){for(let e=1;e<_;e++)if(!t||t.includes(e)){let t=this.handlers[e];t&&this._snapshot[e]<this.wait[e]&&(this.debug("calling",t),t(e)),this._snapshot[e]=this.wait[e]}}}exports.SignalVector=b;const v=256,_=20;class y{constructor(t,e,r){this.prog=t,this.argv=e,this.envp=r}}class j{constructor(t,e){this.env=t,this.val=e}}const S="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;function O(t,e){return e.reduce((e,r)=>Object.assign(e,{[r]:t[r].bind(t)}),{})}
},{"./stubs":"fQPE","./queue":"GjP7","./dyld":"CeSx","./fs":"zmLY"}],"myEq":[function(require,module,exports) {
"use strict";var e,o;Object.defineProperty(exports,"__esModule",{value:!0}),exports.utf8decode=exports.utf8encode=void 0,exports.utf8encode=e,"undefined"!=typeof TextEncoder?exports.utf8encode=e=(e=>(new TextEncoder).encode(e)):exports.utf8encode=e=(e=>Buffer.from(e)),exports.utf8decode=o,"undefined"!=typeof TextDecoder?exports.utf8decode=o=(e=>(new TextDecoder).decode(e)):exports.utf8decode=o=(e=>Buffer.from(e).toString("utf-8"));
},{}],"nTzI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isBrowser=exports.isNode=void 0;const o=global.process&&global.process.versions&&global.process.versions.node;exports.isNode=o;const e="object"==typeof window||"function"==typeof DedicatedWorkerGlobalScope;exports.isBrowser=e;
},{}],"jUBY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ExecCore=exports.WASIExitError=void 0;var t=require("events"),e=l(require("assert")),r=require("@wasmer/wasi"),s=require("@wasmer/wasmfs"),i=d(require("@wasmer/wasm-transformer")),n=require("memfs"),o=require("./streams"),a=require("./bits/tty"),c=require("./bits/proc"),u=require("./bindings/utf8"),h=require("../infra/arch");function f(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return f=function(){return t},t}function d(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=f();if(e&&e.has(t))return e.get(t);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=s?Object.getOwnPropertyDescriptor(t,i):null;n&&(n.get||n.set)?Object.defineProperty(r,i,n):r[i]=t[i]}return r.default=t,e&&e.set(t,r),r}function l(t){return t&&t.__esModule?t:{default:t}}function p(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,s)}return r}function m(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?p(Object(r),!0).forEach(function(e){w(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function w(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}r.WASI.defaultBindings=h.isBrowser?require("@wasmer/wasi/lib/bindings/browser").default:require("@wasmer/wasi/lib/bindings/node").default;class b extends t.EventEmitter{constructor(t={}){super(),this.opts=t=Object.assign({},y,t),this.stdin=t.stdin?new o.SimplexStream:null,this.wasmFs=new s.WasmFs,this.populateRootFs(),this.proc=new c.Proc(this),this.tty=t.tty?new a.Tty(this):null,this.cached=!1!==t.cacheBins?new Map:null,this.init(),this.opts.debug?(this.debug=this._debugPrint(),this.trace=this._tracePrint()):this.debug=this.trace=(()=>{}),this.tty&&(this.tty.debug=((...t)=>this.debug(...t))),this.proc.debug=((...t)=>this.debug(...t))}init(){this.argv=["."],this.env=this.initialEnv(),this.wasi=new r.WASI(m({args:this.argv,env:this.env,bindings:m(m({},r.WASI.defaultBindings),{},{exit:t=>{throw new O(t)},fs:this.wasmFs.fs,path:this.proc.path}),preopens:{"/":"/",".":"."}},this.extraWASIConfig())),this.exited=!1,this.registerStdio(),this.proc.init();let t=this.opts.tty;if(t){var e="number"==typeof t?[t]:"boolean"==typeof t?[0,1,2]:t;this.tty.fds=e;for(let t of e)this.tty.makeTty(t)}}reset(){this.stdin&&this.stdin.reset(),this.init()}async start(t,e,r){this.exited&&this.reset(),e&&this.argv.splice(0,1/0,...e),r&&Object.assign(this.env,r);var s=await this.fetchCompile(t),i=await WebAssembly.instantiate(s,this.getImports(s));this.wasm={module:s,instance:i};try{return this.wasi.start(this.wasm.instance),0}catch(n){if(n instanceof O)return n.code;throw n}finally{this.exited=!0}}get fs(){return this.wasmFs.fs}async fetch(t){if("undefined"!=typeof fetch){const e=await fetch(t);return new Uint8Array(await e.arrayBuffer())}return(0,require("fs").readFileSync)(t)}async fetchCompile(t){return v(this.cached,t,async t=>{var e=await this.fetch(t);return e=await i.lowerI64Imports(e),WebAssembly.compile(e)})}getImports(t){var e=new Set,r={};for(let s of WebAssembly.Module.imports(t))s.module.startsWith("wasi_")&&"wasi_ext"!==s.module&&e.add(s.module);for(let s of e)r[s]=this.wasi.wasiImport;return r.wasi_ext=m(m({},this.proc.extlib),this.tty?this.tty.extlib:{}),r.env=m(m({},this.proc.import),this.tty?this.tty.import:{}),r}share(){return{stdin:this.stdin.to(),tty:this.tty.to(),sigvec:this.proc.sigvec.to(),childq:this.proc.childq.to()}}emitWrite(t,e){return this.emit("stream:out",{fd:t,data:e}),e.length}initialEnv(){return this.opts.env?Object.assign({},this.opts.env):this.defaultEnv()}defaultEnv(){return{PATH:"/bin",PWD:"/home"}}extraWASIConfig(){let t=this.opts;return{traceSyscalls:t.trace&&t.trace.syscalls}}registerStdio(){var t=this.wasmFs.volume;if(!(t.fds[0]&&t.fds[1]&&t.fds[2])){t.releasedFds=[0,1,2];const r=t.openSync("/dev/stderr","w"),s=t.openSync("/dev/stdout","w"),i=t.openSync("/dev/stdin","r");(0,e.default)(0==i&&1==s&&2==r)}this.stdin&&(t.fds[0].read=this.stdin.read.bind(this.stdin)),t.fds[1].write=(t=>this.emitWrite(1,t)),t.fds[2].write=(t=>this.emitWrite(2,t))}mountFs(t){t.fromJSON(this.wasmFs.volume.toJSON()),this.wasmFs.volume=t,this.wasmFs.fs=(0,n.createFsFromVolume)(t),this.init()}populateRootFs(){this.wasmFs.fs.mkdirSync("/home"),this.wasmFs.fs.mkdirSync("/bin")}_debugPrint(){return global.process?(...t)=>this.emitWrite(2,(0,u.utf8encode)(t.join(" ")+"\n")):console.log}_tracePrint(){return global.process?t=>this.emitWrite(2,t):t=>console.warn("[trace]",t,(0,u.utf8decode)(t))}}exports.ExecCore=b;const y={stdin:!0};function g(t,e,r){let s=t.get(e);return s||(s=r(e),t.set(e,s)),s}function v(t,e,r){return t?g(t,e,r):r(e)}class O{constructor(t){this.code=t}}exports.WASIExitError=O;
},{"./streams":"YPBo","./bits/tty":"DocZ","./bits/proc":"SKKL","./bindings/utf8":"myEq","../infra/arch":"nTzI"}],"IYPW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BlockDevice=exports.SharedVolume=void 0;var e,t=require("memfs"),r=require("memfs/lib/volume"),s=require("memfs/lib/node"),i=o(require("assert"));function o(e){return e&&e.__esModule?e:{default:e}}class h extends t.Volume{constructor(e={}){let t;super({Node:class{constructor(e,r){return new l(t,e,r)}},Link:u}),this.dev=n.from(e.dev),t=this;var r=this.root.getNode();r.vol=this,r._link=this.root,this.debug=(()=>{})}static from(e){return new h(e)}to(){return{dev:this.dev.to()}}writeBlob(e,r){var s=this.openSync(e,t.fs.constants.O_CREAT),i=this.fds[s].node,o=this.dev.allocBlob(r.length);o.set(r,0),i.setBlob(o),this.closeSync(s)}createLink(e,t,r,s){const i=super.createLink(e,t,r,s);return e&&this.debug("+ created link",e.ino,t,i.ino),i.push(),i}deleteLink(e){this.debug("deleted link",e.parent.ino,e.getName(),e.ino);var t=e.parent,r=super.deleteLink(e);return t.push(),r}createNode(e=!1,t){if(!this.dev)return super.createNode(e,t);const r=new this.props.Node(this.dev.alloc(),t);return e&&r.setIsDirectory(),this.inodes[r.ino]=r,r.push(),r}getNodeShared(e){return this.inodes[e]||this._fetchNode(e)}createSymlink(e,t){this.symlinkSync("",t);var s=this.getLink((0,r.filenameToSteps)(t)),i=e.split("/");return""==i[0]?i.splice(0,1):i.splice(0,0,"."),s.getNode().makeSymlink(i),s}getResolvedLink(e){let t="string"==typeof e?(0,r.filenameToSteps)(e):e,s=this.root;for(let r=0;r<t.length;){const e=t[r],i=s.getChild(e);if(!i)return null;const o=i.getNode();if(o.isSymlink()){if(t=o.symlink.concat(t.slice(r+1)),r=0,"."!==t[0]){s=this.root;continue}}else s=i;r++}return s}_fetchNode(e){var t=new this.props.Node(e);return this.inodes[e]=t,t}}exports.SharedVolume=h;class n{constructor(e={}){this.raw=e.raw||new SharedArrayBuffer(e.size||1<<20),this.blockSize=e.blockSize||1024,this.blockCount=this.raw.byteLength/this.blockSize,this.bitset=e.bitset||new Uint8Array(new SharedArrayBuffer(this.blockCount)),this.cursors=e.cursors||new Uint32Array(new SharedArrayBuffer(12)),e.cursors||(this.blockCursor=2,this.boundaryCursor=2,this.blobCursor=this.raw.byteLength)}static from(e){return new n(e)}to(){return{raw:this.raw,blockSize:this.blockSize,bitset:this.bitset,cursors:this.cursors}}get(e){var t=e*this.blockSize;return new Uint8Array(this.raw,t,this.blockSize)}isFree(e){return 0==Atomics.load(this.bitset,e)}get blockCursor(){return this.cursors[0]}set blockCursor(e){this.cursors[0]=e}get boundaryCursor(){return this.cursors[1]}set boundaryCursor(e){this.cursors[1]=e}get blobCursor(){return this.cursors[2]}set blobCursor(e){this.cursors[2]=e}alloc(){let e=this.blobCursor/this.blockSize;for(let t=this.blockCursor;t<e;t++)if(0==this.bitset[t]&&0==Atomics.compareExchange(this.bitset,t,0,1))return this.blockCursor=t,this.boundaryCursor=Math.max(this.boundaryCursor,t+1),t;throw new Error("no space left on device")}allocBlob(e){var t=this.blobCursor-e;if(t<this.boundaryCursor*this.blockSize)throw new Error("no space left on device");return this.blobCursor=t,this.getBlob(t,e)}getBlob(e,t){var r=new Uint8Array(this.raw,e,t);return Object.setPrototypeOf(r,Buffer.prototype),r}readText(e,t=0){var r=this.get(e);return r=r.slice(t,r.indexOf(0,t)),{buf:new TextDecoder("utf-8").decode(r),size:r.length+1}}read(e,t=0,r){var s=this.get(e).slice(t,r>=0?t+r:void 0);return{buf:s,size:s.length}}readInto(e,t,r,s,i){var o=this.get(e).subarray(t,t+r);return s.set(o,i),o.length}writeText(e,t,r=0){var s=Buffer.from(t+"\0","utf-8");if(s.length+r>this.blockSize)throw new Error(`inode text overflow (block=${e}, length=${s.length})`);return this.write(e,s,r)}write(e,t,r=0){return r+t.length>this.blockSize&&(t=t.subarray(0,this.blockSize-r)),this.get(e).set(t,r),t.length}}exports.BlockDevice=n;class l extends s.Node{constructor(e,t,r){super(t,r),this.vol=e,this.ver=0,this.isBlob=!1,this._link=null}setModeProperty(e){super.setModeProperty(e),this.ver++,this.push()}getLink(e,t){return this._link||((0,i.default)(e&&t),this._link=new u(this.vol,e,t),this._link.setNode(this)),this._link}setBlob(e){this.buf=e,this.isBlob=!0,this.touch()}touch(){super.touch(),this.ver++,this.push()}del(){super.del()}push(){if(this.vol&&this.vol.dev){var e=this.vol.dev.get(this.ino),t={p:this.perm,m:this.mode,v:this.ver},r=this.buf;0!=e[0]&&(t=Object.assign(this._read().header,t)),r&&(t.z=r.length),this.isBlob&&(t.blob=[r.byteOffset],r=void 0),this.symlink&&(t.symlink=this.symlink),this.vol.debug("+ push node",this.ino,t);var s=this._write(t,r);this._writeTrail(r,s)}}pull(){if(this.vol&&0!=this.vol.dev.get(this.ino)[0]){var{header:e,rdc:t}=this._read();if(this.vol.debug("- pull node",this.ino,e),this.perm=e.p,this.mode=e.m,this.symlink=e.symlink,this.symlink&&console.log("symlink",this.symlink),this.ver!=e.v&&(this.ver=e.v,e.z>=0))if(e.blob)this.buf=this.vol.dev.getBlob(e.blob[0],e.z),this.isBlob=!0;else{var r=Buffer.alloc(e.z),s=this.vol.dev.readInto(this.ino,t,e.z,r,0);e.n>0&&this._readTrail(r,s),this.buf=r,this.isBlob=!1}}}_read(){var{buf:e,size:t}=this.vol.dev.readText(this.ino);return{header:JSON.parse(e),rdc:t}}_write(e,t){var r=this._writeJson(e||{});if(t&&r+t.length>this.vol.dev.blockSize){var s=this._next(e).ino;r=this._writeJson(Object.assign({},e,{n:s}))}return t?this.vol.dev.write(this.ino,t,r):0}_writeJson(e){return this.vol.dev.writeText(this.ino,JSON.stringify(e))}_writeTrail(e,t){for(var r=this;e&&t<e.length;)e=e.subarray(t),t=(r=r._next())._write(null,e),(0,i.default)(t>0)}_readTrail(e,t){for(var r=this;t<e.length;){r=r._next();var{header:s,rdc:o}=r._read();if(o=this.vol.dev.readInto(r.ino,o,e.length-t,e,t),(0,i.default)(o>0),t+=o,!(s.n>=0))break}(0,i.default)(t==e.length)}_next(e){return e||(e=this._read().header),e.n>=0?this.vol.getNodeShared(e.n):this.vol.createNode()}}class u extends s.Link{constructor(t,r,s){return super(t,r,s),this.ver=0,this._dirty=!1,new Proxy(this,new e.LinkHandler)}createChild(e,t=this.vol.createNode()){this._dirty=!0;const r=new u(this.vol,this,e);return r.setNode(t),this.setChild(e,r),r}setChild(e,t){return this._dirty=!0,t=super.setChild(e,t),this.touch(),t}deleteChild(e){this._dirty=!0,super.deleteChild(e),this.touch()}touch(){this.vol.getNodeShared(this.ino).ver++,this.push()}setNode(e){super.setNode(e),e._link=this}getNode(){const e=this.node;return(0,i.default)(e,"LinkSharedVolume.node is unset"),e.pull(),e}push(){if(this.vol.dev){var e={};for(let[t,r]of Object.entries(this.children))e[t]={ino:r.ino};var t=this.getNode(),r=JSON.stringify(e);this.vol.debug("+ push link",this.ino,r),t.buf=Buffer.from(r),t.ver++,t.push(),this.ver=t.ver,this._dirty=!1}}pull(){if(0!=this.vol.dev.get(this.ino)[0]){var e=this.getNode();if(e.pull(),e.isDirectory()&&e.buf&&e.ver!==this.ver){var t=JSON.parse(e.buf.toString("utf-8"));this.vol.debug("- pull link",this.ino,t);var r={};for(let[e,s]of Object.entries(t||{}))if("number"==typeof s.ino){let t=this.vol.getNodeShared(s.ino);r[e]=t.getLink(this,e)}this.children=r,this.ver=e.ver,this._dirty=!1}}}}!function(e){e.LinkHandler=class{get(e,t){return"children"===t&&e.vol.dev&&!e._dirty&&e.pull(),e[t]}};e.LinkChildren=class{constructor(e){this.link=e}getOwnPropertyDescriptor(e,t){return this.link.pull(),e.hasOwnProperty(t)?{configurable:!0,enumerable:!0}:void 0}get(e,t){return this.link.pull(),e[t]}set(e,t,r){return e[t]=r,!0}}}(e||(e={}));
},{}],"kuzr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.postMessage=exports.onMessage=exports.Worker=void 0;var e=require("../../infra/arch");let s,t,r;if(exports.onMessage=r,exports.postMessage=t,exports.Worker=s,e.isBrowser)exports.Worker=s=self.Worker,exports.postMessage=t=self.postMessage,exports.onMessage=r=(e=>addEventListener("message",e));else if(e.isNode){const e=require("worker_threads");class o{constructor(s){this.thread=new e.Worker(s)}addEventListener(e,s){this.thread.on(e,e=>{s({data:e})})}postMessage(e){this.thread.postMessage(e)}static onMessage(s){e.parentPort.on("message",e=>{s({data:e})})}static postMessage(s){e.parentPort.postMessage(s)}}exports.Worker=s=o,exports.onMessage=r=o.onMessage,exports.postMessage=t=o.postMessage}
},{"../../infra/arch":"nTzI"}],"ZXZ8":[function(require,module,exports) {
"use strict";var e=require("./exec"),a=require("./services/shared-fs"),t=require("./bindings/workers");const s=new e.ExecCore({tty:!0});(0,t.postMessage)(s.share()),s.on("stream:out",e=>(0,t.postMessage)(e)),s.tty.on("data",e=>(0,t.postMessage)({event:"tty:data",arg:e})),s.proc.on("syscall",e=>(0,t.postMessage)({event:"syscall",arg:e})),(0,t.onMessage)(async e=>{if(e.data.upload)for(let a in e.data.upload)s.wasmFs.fs.writeFileSync(a,e.data.upload[a]);if(e.data.volume&&s.mountFs(a.SharedVolume.from(e.data.volume)),e.data.dyld)for(let a of e.data.dyld.preload||[])s.proc.dyld.preload(a.name,a.uri,a.reloc);if(e.data.exec){let a=e.data.exec,r=e.data.opts&&e.data.opts.argv,d=e.data.opts&&e.data.opts.env;try{let e=await s.start(a,r,d);(0,t.postMessage)({event:"exit",arg:{code:e}})}catch(o){(0,t.postMessage)({event:"error",arg:o})}}}),self.core=s;
},{"./exec":"jUBY","./services/shared-fs":"IYPW","./bindings/workers":"kuzr"}]},{},["ZXZ8"], null)
//# sourceMappingURL=/worker.8e73be95.js.map